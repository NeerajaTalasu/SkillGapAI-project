<!DOCTYPE html>
<html>
<head>
    <title>SkillGap AI Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<div class="container">

    <h1>SkillGap AI Dashboard</h1>

    <div class="card-container">
        <div class="card">
            <h3>Resume Skills</h3>
            <p>{{ data.resume }}</p>
        </div>

        <div class="card">
            <h3>Job Description Skills</h3>
            <p>{{ data.jd }}</p>
        </div>
    </div>

    <div class="chart-row">
        <div id="donut" class="chart"></div>
        <div id="gauge" class="chart"></div>
    </div>

    <div id="bar" style="width: 85%; height: 350px; margin: 40px auto;"></div>

    <div class="section">
        <h2>Detailed Skill Table</h2>
        <table>
            <tr><th>Skill</th><th>Status</th><th>Similarity</th></tr>
            {% for row in data.table %}
            <tr>
                <td>{{ row.Skill }}</td>
                <td>{{ row.Status }}</td>
                <td>{{ row.Similarity }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div class="section">
        <h2>Recommendations</h2>
        <ul>
            {% for r in data.recommendations %}
            <li>{{ r }}</li>
            {% endfor %}
        </ul>
    </div>

    <div style="text-align:center; margin-top:30px; margin-bottom:60px;">
        <a href="/download">
            <button style="padding:12px 22px; background:#2563eb; color:white; border:none; border-radius:10px; font-size:18px; cursor:pointer;">
                Download Skill Report CSV
            </button>
        </a>
    </div>

</div>

<script>
    let matched = {{ data.matched_count }};
    let partial = {{ data.partial_count }};
    let missing = {{ data.missing_count }};
    let score = {{ data.score }};
    let labels = {{ data.partial_labels | tojson }};
    let values = {{ data.partial_values | tojson }};

    Plotly.newPlot('donut', [{
        values: [matched, partial, missing],
        labels: ["Matched", "Partial", "Missing"],
        type: "pie",
        hole: .5,
        marker: { colors: ["#22c55e", "#f59e0b", "#ef4444"] }
    }], {
        title: "Skill Completion Distribution"
    });

    Plotly.newPlot('gauge', [{
        type: "indicator",
        mode: "gauge+number",
        value: score,
        title: { text: "Skill Match Score", font: { size: 28 }},
        gauge: {
            axis: { range: [0, 100] },
            bar: { color: "#2563eb" },
            steps: [
                { range: [0, 50], color: "#ffcdd2" },
                { range: [50, 80], color: "#fff9c4" },
                { range: [80, 100], color: "#c8e6c9" }
            ]
        }
    }]);

    Plotly.newPlot('bar', [{
        x: labels,
        y: values,
        type: "bar",
        marker: { color: "#2563eb" }
    }], {
        title: "Partial Skill Similarity Score",
        yaxis: { title: "Similarity Score" }
    });
</script>

</body>
</html>
